<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <!-- TODO: add favicon -->
    <link rel="shortcut icon" href="assets/images/favicon.ico">
    <meta name="referrer" content="origin">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Convert your annual salary into an hourly rate.</title>
    <!--[if lt IE 9]>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.js"></script>
    <![endif]-->
    <script src="assets/javascripts/jquery.min.js"></script>
    <script src="assets/javascripts/rangeslider.min.js"></script>
    <link rel="stylesheet" type="text/css" href="assets/stylesheets/calculator.min.css"/>
    <!-- Increment/Decrement icons courtesy of Font Awesome: https://fontawesome.com/license -->
  </head>
  <body>
    <div class="corner-ribbon top-right sticky blue"><a href="http://dpmehta.com">By Dev</a></div>
    <div class="container">
      <!-- <h3>Convert your annual salary into an hourly rate.</h3> -->
      <!-- Pulse the hourly total (and color quickly) if assumption updated, both annual and hourly if slider adjusted, only equiv on page load -->
      <h1>
        <table class="headline">
          <tr>
            <th class="salary left-slide-in" id="leftSlider">Annual Salary</th>
            <th rowspan="2" class="equivalency">=</th>
            <th class="hourly right-slide-in" id="rightSlider">Hourly Rate</th>
          </tr>
          <tr>
            <td id="annualOutput" class="left-slide-in">
              <output id="annualOutput" class="headlineOutput currency"></output>
            </td>
            <td id="hourlyOutput" class="right-slide-in">
              <output id="hourlyOutput" class="headlineOutput currency"></output>
            </td>
          </tr>
        </table>
      </h1>
      <input type="range" min="50000" max="250000" step="5000" value="150000" id="annualInput" data-rangeslider> </input>
      <table class="assumptions">
        <tr><th class="assumptions-header" colspan="5"><h2>Assumptions</h2></th></tr>
        <tr>
          <td class="label">PTO (Days)</td>
          <td class="decrement"><input type="image" id="ptoDecrement" src="assets/images/32px-Circle_arrow_down_font_awesome.svg.png" class="assumption-data" /></td>
          <td class="data"><output id="ptoOutput" type="number" value="15" class="assumption-data"></output></td>
          <td class="increment"><input type="image" id="ptoIncrement" src="assets/images/32px-Circle_arrow_up_font_awesome.svg.png" class="assumption-data" /></td>
          <td class="empty"></td>
        </tr>
        <tr>
          <td class="label">National Holidays</td>
          <td class="decrement"><input type="image" id="holidaysDecrement" src="assets/images/32px-Circle_arrow_down_font_awesome.svg.png" class="assumption-data" /></td>
          <td class="data"><output id="holidaysOutput" type="number" value="15" class="assumption-data"></output></td>
          <td class="increment"><input type="image" id="holidaysIncrement" src="assets/images/32px-Circle_arrow_up_font_awesome.svg.png" class="assumption-data" /></td>
          <td class="empty"></td>
        </tr>
        <tr>
          <td class="label">Work Days / Year</td>
          <td class="decrement"><input type="image" id="workDaysDecrement" src="assets/images/32px-Circle_arrow_down_font_awesome.svg.png" class="assumption-data" /></td>
          <td class="data"><output id="workDaysOutput" type="number" value="261" class="assumption-data"></output></td>
          <td class="increment"><input type="image" id="workDaysIncrement" src="assets/images/32px-Circle_arrow_up_font_awesome.svg.png" class="assumption-data" /></td>
          <td class="empty"></td>
        </tr>
        <!-- TODO: combine work hours/day and non-billable into one range slider of 24 hours w/ one range billable, other non-billable, rest non-work -->
        <tr>
          <td class="label">Work Hours / Day</td>
          <td class="decrement"><input type="image" id="workHoursDecrement" src="assets/images/32px-Circle_arrow_down_font_awesome.svg.png" class="assumption-data" /></td>
          <td class="data"><output id="workHoursOutput" type="number" value="8" class="assumption-data"></output></td>
          <td class="increment"><input type="image" id="workHoursIncrement" src="assets/images/32px-Circle_arrow_up_font_awesome.svg.png" class="assumption-data" /></td>
          <td class="empty"></td>
        </tr>
        <tr>
          <td class="label">Non-Billable Hours / Day</td>
          <td class="decrement"><input type="image" id="nonBillableDecrement" src="assets/images/32px-Circle_arrow_down_font_awesome.svg.png" class="assumption-data" /></td>
          <td class="data"><output id="nonBillableOutput" type="number" value="1" class="assumption-data"></output></td>
          <td class="increment"><input type="image" id="nonBillableIncrement" src="assets/images/32px-Circle_arrow_up_font_awesome.svg.png" class="assumption-data" /></td>
          <td class="empty"></td>
        </tr>
        <tr>
          <td class="label">Sick Days / Year</td>
          <td class="decrement"><input type="image" id="sickDecrement" src="assets/images/32px-Circle_arrow_down_font_awesome.svg.png" class="assumption-data" /></td>
          <td class="data"><output id="sickOutput" type="number" value="1" class="assumption-data"></output></td>
          <td class="increment"><input type="image" id="sickIncrement" src="assets/images/32px-Circle_arrow_up_font_awesome.svg.png" class="assumption-data" /></td>
          <td class="empty"></td>
        </tr>
        <tr>
          <td class="label">Days between contracts / Month</td>
          <td class="decrement"><input type="image" id="daysBetweenDecrement" src="assets/images/32px-Circle_arrow_down_font_awesome.svg.png" class="assumption-data" /></td>
          <td class="data"><output id="daysBetweenOutput" type="number" value="3" class="assumption-data"></output></td>
          <td class="increment"><input type="image" id="daysBetweenIncrement" src="assets/images/32px-Circle_arrow_up_font_awesome.svg.png" class="assumption-data" /></td>
          <td class="empty"></td>
        </tr>
        <tr>
          <td class="label">Monthly Insurance</td>
          <td class="decrement"><input type="image" id="insuranceDecrement" src="assets/images/32px-Circle_arrow_down_font_awesome.svg.png" class="assumption-data" /></td>
          <td class="data"><output id="insuranceOutput" type="number" value="500" class="assumption-data currency"></output></td>
          <td class="increment"><input type="image" id="insuranceIncrement" src="assets/images/32px-Circle_arrow_up_font_awesome.svg.png" class="assumption-data" /></td>
          <td class="empty"></td>
        </tr>
        <tr>
          <td class="label">Self-employment Tax</td>
          <td class="decrement"><input type="image" id="employmentTaxDecrement" src="assets/images/32px-Circle_arrow_down_font_awesome.svg.png" class="assumption-data" /></td>
          <td class="data"><output id="employmentTaxOutput" type="number" value="7" class="assumption-data percent"></output></td>
          <td class="increment"><input type="image" id="employmentTaxIncrement" src="assets/images/32px-Circle_arrow_up_font_awesome.svg.png" class="assumption-data" /></td>
          <td class="empty"></td>
        </tr>
        <tr>
          <td class="label">Yearly Equipment Cost</td>
          <td class="decrement"><input type="image" id="yearlyEquipmentDecrement" src="assets/images/32px-Circle_arrow_down_font_awesome.svg.png" class="assumption-data" /></td>
          <td class="data"><output id="yearlyEquipmentOutput" type="number" value="2000" class="assumption-data currency"></output></td>
          <td class="increment"><input type="image" id="yearlyEquipmentIncrement" src="assets/images/32px-Circle_arrow_up_font_awesome.svg.png" class="assumption-data" /></td>
          <td class="empty"></td>
        </tr>
        <tr>
          <td class="label">Yearly Bonus</td>
          <td class="decrement"><input type="image" id="bonusDecrement" src="assets/images/32px-Circle_arrow_down_font_awesome.svg.png" class="assumption-data" /></td>
          <td class="data"><output id="bonusOutput" type="number" value="2000" class="assumption-data currency"></output></td>
          <td class="increment"><input type="image" id="bonusIncrement" src="assets/images/32px-Circle_arrow_up_font_awesome.svg.png" class="assumption-data" /></td>
          <td class="empty"></td>
        </tr>
      </table>
    </div>
    <script>
      $(function() {
        // For ie8 support
        var textContent = ('textContent' in document) ? 'textContent' : 'innerText';

        // Core data structure for assumptions
        const $assumptions = {
          'annual': {
            'starting': 150000,
            'max': 250000,
            'min': 50000,
            'units': 'currency',
            'step': 5000,
            'outputElementId': '#annualOutput'
          },
          'hourly': {
            'starting': 125,
            'max': 100000,
            'min': 0,
            'units': 'currency',
            'step': 1,
            'outputElementId': '#hourlyOutput'
          },
          'workDays': {
            'starting': 261,
            'max': 365,
            'min': 0,
            'units': 'days',
            'step': 1,
            'outputElementId': '#workDaysOutput'
          },
          'workHours': {
            'starting': 8,
            'max': 24,
            'min': 0,
            'units': 'hours',
            'step': 0.5,
            'outputElementId': '#workHoursOutput'
          },
          'nonBillable': {
            'starting': 1,
            'max': 24,
            'min': 0,
            'units': 'hours',
            'step': 0.5,
            'outputElementId': '#nonBillableOutput'
          },
          'pto': {
            'starting': 15,
            'max': 40,
            'min': 0,
            'units': 'days',
            'step': 1,
            'outputElementId': '#ptoOutput'
          },
          'holidays': {
            'starting': 10,
            'max': 30,
            'min': 0,
            'units': 'days',
            'step': 1,
            'outputElementId': '#holidaysOutput'
          },
          'sick': {
            'starting': 5,
            'max': 25,
            'min': 0,
            'units': 'days',
            'step': 1,
            'outputElementId': '#sickOutput'
          },
          'daysBetween': {
            'starting': 3,
            'max': 14,
            'min': 0,
            'units': 'days',
            'step': 1,
            'outputElementId': '#daysBetweenOutput'
          },
          'insurance': {
            'starting': 500,
            'max': 10000,
            'min': 0,
            'units': 'currency',
            'step': 50,
            'outputElementId': '#insuranceOutput'
          },
          'employmentTax': {
            'starting': 7,
            'max': 100,
            'min': 0,
            'units': 'percent',
            'step': 0.5,
            'outputElementId': '#employmentTaxOutput'
          },
          'yearlyEquipment': {
            'starting': 2000,
            'max': 20000,
            'min': 0,
            'units': 'currency',
            'step': 100,
            'outputElementId': '#yearlyEquipmentOutput'
          },
          'bonus': {
            'starting': 5000,
            'max': 100000,
            'min': 0,
            'units': 'currency',
            'step': 250,
            'outputElementId': '#bonusOutput'
          }
        }

        /*
         * Helpers
         **/
        function getOutputElemById(id) {
          return $('output' + id)[0];
        }

        function getNumericValueById(id) {
          var element = getOutputElemById(id);
          return castIntoFormattedNumber(element.value);
        }

        function castIntoFormattedNumber(val) {
          if (typeof(val) === 'string') { val = Number(val.replace(/[$,%]+/g,"")); }
          return val;
        }

        function valueOutput(element) {
          var value = element.value;
          var output = element.parentNode.getElementsByTagName('output')[0] || element.parentNode.parentNode.getElementsByTagName('output')[0];
          output[textContent] = Number(value).toLocaleString();
        }

        function initializeOutputs() {
          Object.entries($assumptions).forEach(
            ([k, v]) => {
              var output = $('output#' + k + 'Output')[0];
              output.value = v['starting'];
              valueOutput(output);
            }
          );
        }

        function recalculateHourly() {
          const annualSalary = getNumericValueById($assumptions.annual.outputElementId);
          const workDays = getNumericValueById($assumptions.workDays.outputElementId);
          const workHours = getNumericValueById($assumptions.workHours.outputElementId);
          const nonBillable = getNumericValueById($assumptions.nonBillable.outputElementId);
          const pto = getNumericValueById($assumptions.pto.outputElementId);
          const holidays = getNumericValueById($assumptions.holidays.outputElementId);
          const sickDays = getNumericValueById($assumptions.sick.outputElementId);
          const daysBetween = getNumericValueById($assumptions.daysBetween.outputElementId);
          const monthlyInsurance = getNumericValueById($assumptions.insurance.outputElementId);
          const employmentTax = getNumericValueById($assumptions.employmentTax.outputElementId);
          var formattedEmploymentTax = employmentTax * 0.01 + 1;
          const yearlyEquipment = getNumericValueById($assumptions.yearlyEquipment.outputElementId);
          const yearlyBonus = getNumericValueById($assumptions.bonus.outputElementId);

          var numerator = (annualSalary + (monthlyInsurance * 12) + yearlyBonus) * formattedEmploymentTax + yearlyEquipment;
          var denominator = (workDays - pto - holidays - sickDays - (daysBetween * 12)) * (workHours - nonBillable);

          return Math.round(numerator / denominator);
        }

        /*
         * DOM manipulation
         **/

        // Handle increment/decrement
        var incrementDecrementIds = Object.keys($assumptions).map(x => '#' + x + 'Increment, ' + '#' + x + 'Decrement,' ).join(' ').slice(0, -1);
        $(incrementDecrementIds).on('click', function (e) {
          updateCorrespondingOutput(e);
          updateHourly();
        });

        function updateCorrespondingOutput(element) {
          const eId = element.currentTarget.id;
          const assumptionKey = /(.*)(Increment|Decrement)/.exec(eId)[1];
          const assumptionData = $assumptions[assumptionKey];
          var outputElement = getOutputElemById(assumptionData.outputElementId);
          var numericValue = castIntoFormattedNumber(outputElement.value);
          if (eId.includes('Increment') && numericValue < assumptionData.max) {
            outputElement.value = numericValue + assumptionData.step;
          } else if (eId.includes('Decrement') && numericValue > assumptionData.min) {
            outputElement.value = numericValue - assumptionData.step;
          } else {
            return;
          }
          valueOutput(outputElement);
        }

        // Recalculate the new hourly total and update the DOM
        function updateHourly() {
          var hourlyOutput = getOutputElemById($assumptions.hourly.outputElementId);
          hourlyOutput.value = recalculateHourly();
          valueOutput(hourlyOutput);
        }

        // Updates the Annual Salary when the slider is moved
        $(document).on('input', 'input[type="range"]#annualInput, [data-rangeslider]', function(e) {
          valueOutput(e.target);
        });

        // Initialize range slider and outputs
        $('input[type="range"]#annualInput').rangeslider({
          polyfill: false,
          onInit: function() {
            initializeOutputs();
          },
          onSlide: function(position, value) {
              updateHourly();
          },
        });
      });
    </script>
  </body>
</html>
