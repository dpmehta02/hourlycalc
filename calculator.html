<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <!-- TODO: add favicon -->
    <link rel="shortcut icon" href="assets/images/favicon.ico">
    <meta name="referrer" content="origin">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Convert your annual salary into an hourly rate.</title>
    <!--[if lt IE 9]>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.js"></script>
    <![endif]-->
    <script src="assets/javascripts/jquery.min.js"></script>
    <script src="assets/javascripts/rangeslider.min.js"></script>
    <script src="assets/javascripts/calculator.js"></script>
    <link rel="stylesheet" type="text/css" href="assets/stylesheets/calculator.css"/>
    <!-- Add goog Analytics tracking -->
    <!-- Increment/Decrement icons courtesy of Font Awesome: https://fontawesome.com/license -->
  </head>
  <body>
    <div class="container">
      <!-- <h3>Convert your annual salary into an hourly rate.</h3> -->
      <!-- Fade in from left to right, first annual, then equiv, than hourly (Right to left). Pulse once equiv every time slider ends, or assumption changes -->
      <!-- Or maybe pulse the hourly total if assumption updated, both annual and hourly if slider adjusted, only equiv on page load -->
      <h1>
        <table class="headline">
          <tr>
            <th class="salary">Annual Salary</th>
            <th rowspan="2" class="equivalency">=</th>
            <th class="hourly">Hourly Rate</th>
          </tr>
          <tr>
            <td>
              <output id="annualOutput" class="headlineOutput currency"></output>
            </td>
            <td>
              <output id="hourlyOutput" class="headlineOutput currency"></output>
            </td>
          </tr>
        </table>
      </h1>
      <input type="range" min="50000" max="250000" step="5000" value="150000" id="annualInput" data-rangeslider> </input>
      <table class="assumptions">
        <tr><th class="assumptions-header" colspan="2"><h2>Assumptions</h2></th></tr>
        <!-- Align increments on right side ... -->
        <tr>
          <td class="label">PTO (Days)</td>
          <td class="data">
            <input type="image" id="ptoDecrement" src="assets/images/32px-Circle_arrow_down_font_awesome.svg.png" class="assumption-data" />
            <output id="ptoOutput" type="number" value="15" class="assumption-data"></output>
            <input type="image" id="ptoIncrement" src="assets/images/32px-Circle_arrow_up_font_awesome.svg.png" class="assumption-data" />
          </td>
        </tr>
        <tr>
          <td class="label">National Holidays</td>
          <td class="data">
            <input type="image" id="holidaysDecrement" src="assets/images/32px-Circle_arrow_down_font_awesome.svg.png" class="assumption-data" />
            <output id="holidaysOutput" type="number" value="15" class="assumption-data"></output>
            <input type="image" id="holidaysIncrement" src="assets/images/32px-Circle_arrow_up_font_awesome.svg.png" class="assumption-data" />
          </td>
        </tr>
        <tr>
          <td class="label">Work Days / Year</td>
          <td class="data">
            <!-- TODO: add tooltips for assumptions (e.g., citations) -->
            <input type="image" id="workDaysDecrement" src="assets/images/32px-Circle_arrow_down_font_awesome.svg.png" class="assumption-data" />
            <output id="workDaysOutput" type="number" value="261" class="assumption-data"></output>
            <input type="image" id="workDaysIncrement" src="assets/images/32px-Circle_arrow_up_font_awesome.svg.png" class="assumption-data" />
          </td>
        </tr>
        <!-- TODO: combine work hours/day and non-billable into one range slider of 24 hours w/ one range billable, other non-billable, rest non-work -->
        <tr>
          <td class="label">Work Hours / Day</td>
          <td class="data">
            <input type="image" id="workHoursDecrement" src="assets/images/32px-Circle_arrow_down_font_awesome.svg.png" class="assumption-data" />
            <output id="workHoursOutput" type="number" value="8" class="assumption-data"></output>
            <input type="image" id="workHoursIncrement" src="assets/images/32px-Circle_arrow_up_font_awesome.svg.png" class="assumption-data" />
          </td>
        </tr>
        <tr>
          <td class="label">Non-Billable Hours / Day</td>
          <td class="data">
            <input type="image" id="nonBillableDecrement" src="assets/images/32px-Circle_arrow_down_font_awesome.svg.png" class="assumption-data" />
            <output id="nonBillableOutput" type="number" value="1" class="assumption-data"></output>
            <input type="image" id="nonBillableIncrement" src="assets/images/32px-Circle_arrow_up_font_awesome.svg.png" class="assumption-data" />
          </td>
        </tr>
        <tr>
          <td class="label">Sick Days</td>
          <td class="data">
            <input type="image" id="sickDecrement" src="assets/images/32px-Circle_arrow_down_font_awesome.svg.png" class="assumption-data" />
            <output id="sickOutput" type="number" value="1" class="assumption-data"></output>
            <input type="image" id="sickIncrement" src="assets/images/32px-Circle_arrow_up_font_awesome.svg.png" class="assumption-data" />
          </td>
        </tr>
        <tr>
          <td class="label">Days between contracts / Month</td>
          <td class="data">
            <input type="image" id="daysBetweenDecrement" src="assets/images/32px-Circle_arrow_down_font_awesome.svg.png" class="assumption-data" />
            <output id="daysBetweenOutput" type="number" value="3" class="assumption-data"></output>
            <input type="image" id="daysBetweenIncrement" src="assets/images/32px-Circle_arrow_up_font_awesome.svg.png" class="assumption-data" />
          </td>
        </tr>
        <tr>
          <td class="label">Monthly Insurance</td>
          <td class="data">
            <input type="image" id="insuranceDecrement" src="assets/images/32px-Circle_arrow_down_font_awesome.svg.png" class="assumption-data" />
            <output id="insuranceOutput" type="number" value="500" class="assumption-data currency"></output>
            <input type="image" id="insuranceIncrement" src="assets/images/32px-Circle_arrow_up_font_awesome.svg.png" class="assumption-data" />
          </td>
        </tr>
      </table>
    </div>
    <script>
      $(function() {
        // For ie8 support
        var textContent = ('textContent' in document) ? 'textContent' : 'innerText';

        // Headline items
        $annualOutput = $('output#annualOutput')[0];
        $startingAnnual = 150000;
        $hourlyOutput = $('output#hourlyOutput')[0];
        $startingHourly = 100;
        // Assumptions
        $workDaysOutput = $('output#workDaysOutput')[0];
        $startingWorkDays = 261;
        $workHoursOutput = $('output#workHoursOutput')[0];
        $startingWorkHours = 8;
        $nonBillableOutput = $('output#nonBillableOutput')[0];
        $startingNonBillable = 1;
        $ptoOutput = $('output#ptoOutput')[0];
        $startingPto = 15;
        $holidaysOutput = $('output#holidaysOutput')[0];
        $startingHolidays = 10;
        $sickOutput = $('output#sickOutput')[0];
        $startingSick = 5;
        $daysBetweenOutput = $('output#daysBetweenOutput')[0];
        $startingDaysBetween = 3;
        $insuranceOutput = $('output#insuranceOutput')[0];
        $startingInsurance = 500;

        $currencyOutputs = ['insuranceOutput']

        const $assumptions = {
          'annual': {
            'starting': 150000,
            'max': 250000,
            'min': 50000,
            'units': 'currency',
            'step': 5000,
            'outptutElementId': '#annualOutput'
          },
          'hourly': {
            'starting': 0,
            'max': 100000,
            'min': 0,
            'units': 'currency',
            'step': 1,
            'outptutElementId': '#hourlyOutput'
          },
          'workDays': {
            'starting': 261,
            'max': 365,
            'min': 0,
            'units': 'days',
            'step': 1,
            'outptutElementId': '#workDaysOutput'
          },
          'workHours': {
            'starting': 8,
            'max': 24,
            'min': 0,
            'units': 'hours',
            'step': 0.5,
            'outptutElementId': '#workHoursOutput'
          },
          'nonBillable': {
            'starting': 1,
            'max': 24,
            'min': 0,
            'units': 'hours',
            'step': 0.5,
            'outptutElementId': '#nonBillableOutput'
          },
          'pto': {
            'starting': 15,
            'max': 40,
            'min': 0,
            'units': 'days',
            'step': 1,
            'outptutElementId': '#ptoOutput'
          },
          'holidays': {
            'starting': 10,
            'max': 30,
            'min': 0,
            'units': 'days',
            'step': 1,
            'outptutElementId': '#holidaysOutput'
          },
          'sick': {
            'starting': 5,
            'max': 25,
            'min': 0,
            'units': 'days',
            'step': 1,
            'outptutElementId': '#sickOutput'
          },
          'daysBetween': {
            'starting': 3,
            'max': 14,
            'min': 0,
            'units': 'days',
            'step': 1,
            'outptutElementId': '#daysBetweenOutput'
          },
          'insurance': {
            'starting': 500,
            'max': 10000,
            'min': 0,
            'units': 'currency',
            'step': 50,
            'outptutElementId': '#insuranceOutput'
          }
        }

        // Update the DOM with the new value
        function valueOutput(element) {
          var value = element.value;
          var output = element.parentNode.getElementsByTagName('output')[0] || element.parentNode.parentNode.getElementsByTagName('output')[0];
          output[textContent] = Number(value).toLocaleString();
        }

        function initializeOutputs() {
          Object.entries($assumptions).forEach(
            ([k, v]) => {
              var output = $('output#' + k + 'Output')[0];
              output.value = v['starting'];
              valueOutput(output);
            }
          );
        }

        function convertCurrencyIntoNumber(currency_string) {
          return Number(currency_string.replace(/[$,]+/g,""));
        }

        function adjustAndReturnTarget(element) {
          id = element.currentTarget.id;
          var maxes = {
            'workDaysIncrement': 365,
            'workHoursIncrement': 24,
            'nonBillableIncrement': 24, // Should be capped by 24 - Current Work Hours/Day?
            'ptoIncrement': 40,
            'holidaysIncrement': 40,
            'sickIncrement': 25,
            'daysBetweenIncrement': 14,
            'insuranceIncrement': 5000
          }
          var mins = {
            'workDaysDecrement': 0,
            'workHoursDecrement': 0,
            'nonBillableDecrement': 0,
            'ptoDecrement': 0,
            'holidaysDecrement': 0,
            'sickDecrement': 0,
            'daysBetweenDecrement': 0,
            'insuranceDecrement': 0
          }

          // TODO: Refactor
          var target = null;
          var step = 1;
          if (id.includes('Increment')) {
            target = element.target.previousElementSibling;
            if ($currencyOutputs.includes(target.id)) {
              target.value = convertCurrencyIntoNumber(target.value);
              step = 100;
            }
            if (target.value < maxes[id]) {
              target.value = Number(target.value) + step;
            }
          } else if (id.includes('Decrement')) {
            target = element.target.nextElementSibling;
            if ($currencyOutputs.includes(target.id)) {
              target.value = convertCurrencyIntoNumber(target.value);
              step = 100;
            }
            if (target.value > mins[id]) {
              target.value = Number(target.value) - step;
            }
          } else {
            console.log('Uh oh. Something went wrong.');
          }

          return target;
        }

        // Increment/Decrement, then update the hourly total
        const incrementDecrementIds = "#workDaysIncrement, #workDaysDecrement, #workHoursIncrement, \
          #workHoursDecrement, #nonBillableIncrement, #nonBillableDecrement, #ptoIncrement, #ptoDecrement, \
          #holidaysIncrement, #holidaysDecrement, #sickIncrement, #sickDecrement, #daysBetweenIncrement, \
          #daysBetweenDecrement, #insuranceIncrement, #insuranceDecrement"
        $(incrementDecrementIds).on('click', function (e) {
          var target = adjustAndReturnTarget(e);
          valueOutput(target);
          updateHourly();
        });

        // Recalculate the new hourly total and update the DOM
        function updateHourly() {
          // Recalculate

          // Assign it to the element
          $hourlyOutput.value = 150;

          // Update the DOM
          valueOutput($hourlyOutput);
        }

        $(document).on('input', 'input[type="range"]#annualInput, [data-rangeslider]', function(e) {
          valueOutput(e.target);
        });

        // Initialize range slider and outputs
        $('input[type="range"]#annualInput').rangeslider({
          polyfill: false,
          onInit: function() {
            initializeOutputs();
          },

          onSlide: function(position, value) {
              updateHourly();
          },

        });
      });
    </script>
  </body>
</html>
