<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="referrer" content="origin">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Convert annual salary into hourly rate</title>
    <!--[if lt IE 9]>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.js"></script>
    <![endif]-->
    <script src="assets/javascripts/jquery.min.js"></script>
    <script src="assets/javascripts/rangeslider.min.js"></script>
    <script src="assets/javascripts/calculator.js"></script>
    <link rel="stylesheet" type="text/css" href="assets/stylesheets/calculator.css"/>
    <!-- Add goog Analytics tracking -->
    <!-- Increment/Decrement icons courtesy of Font Awesome: https://fontawesome.com/license -->
  </head>
  <body>
    <div class="container">
      <!-- Fade in from left to right, first annual, then equiv, than hourly (Right to left). Pulse once equiv every time slider ends, or assumption changes -->
      <!-- Or maybe pulse the hourly total if assumption updated, both annual and hourly if slider adjusted, only equiv on page load -->
      <h1>
        <table class="headline">
          <tr>
            <th class="salary">Annual Salary</th>
            <th rowspan="2" class="equivalency">=</th>
            <th class="hourly">Hourly Rate</th>
          </tr>
          <tr>
            <td>
              <output id="annualOutput" class="headlineOutput"></output>
            </td>
            <td>
              <output id="hourlyOutput" class="headlineOutput"></output>
            </td>
          </tr>
        </table>
      </h1>
      <input type="range" min="50000" max="250000" step="5000" value="150000" id="annualInput" data-rangeslider> </input>
      <table class="assumptions">
        <tr><th class="assumptions-header"><h2>Assumptions</h2></th></tr>
        <tr><th class="assumptions-label">Work Days / Year</th></tr>
        <tr>
          <td>
            <!-- TODO: add tooltips for assumptions (e.g., citations) -->
            <input type="image" id="workDaysDecrement" src="assets/images/32px-Circle_arrow_down_font_awesome.svg.png" class="assumption-data" />
            <b><output id="workDaysOutput" type="number" value="261" class="assumption-data"></output></b>
            <input type="image" id="workDaysIncrement" src="assets/images/32px-Circle_arrow_up_font_awesome.svg.png" class="assumption-data" />
          </td>
        </tr>
        <tr><th class="assumptions-label">Work Hours / Day</th></tr>
        <tr>
          <td>
            <input type="image" id="workHoursDecrement" src="assets/images/32px-Circle_arrow_down_font_awesome.svg.png" class="assumption-data" />
            <b><output id="workHoursOutput" type="number" value="8" class="assumption-data"></output></b>
            <input type="image" id="workHoursIncrement" src="assets/images/32px-Circle_arrow_up_font_awesome.svg.png" class="assumption-data" />
          </td>
        </tr>
      </table>
    </div>
    <script>
      $(function() {
        // For ie8 support
        var textContent = ('textContent' in document) ? 'textContent' : 'innerText';

        // Headline items
        $annualOutput = $('output#annualOutput')[0];
        $startingAnnual = 150000;
        $hourlyOutput = $('output#hourlyOutput')[0];
        $startingHourly = 100;
        // Assumptions
        $workDaysOutput = $('output#workDaysOutput')[0];
        $startingWorkDays = 261;
        $workHoursOutput = $('output#workHoursOutput')[0];
        $startingWorkHours = 8;

        // Helpers
        function valueOutput(element, currency = null) {
          var value = element.value;
          var output = element.parentNode.getElementsByTagName('output')[0] || element.parentNode.parentNode.getElementsByTagName('output')[0];
          var prepend = currency ? '$' : ''
          output[textContent] = prepend + Number(value).toLocaleString();
        }

        function adjustAndReturnTarget(element) {
          id = element.currentTarget.id;
          var maxes = {
            'workDaysIncrement': 365,
            'workHoursIncrement': 24
          }
          var mins = {
            'workDaysDecrement': 0,
            'workHoursDecrement': 0
          }

          var target = null;
          if (id.includes('Increment')) {
            target = element.target.previousElementSibling;
            if (target.value < maxes[id]) { target.value++; }
          } else if (id.includes('Decrement')) {
            target = element.target.nextElementSibling;
            if (target.value > mins[id]) { target.value--; }
          } else {
            console.log('Uh oh. Something went wrong.');
          }

          return target;
        }

        // Increment/Decrement, then update the hourly total
        $("#workDaysIncrement, #workDaysDecrement, #workHoursIncrement, #workHoursDecrement").on('click', function (e) {
          var target = adjustAndReturnTarget(e);
          valueOutput(target);
          updateHourly();
        });

        // Recalculate the new hourly total and update the DOM
        function updateHourly() {
          // Recalculate

          // Assign it to the element
          $hourlyOutput.value = 150;

          // Update the DOM
          valueOutput($hourlyOutput, currency = true);
        }

        $(document).on('input', 'input[type="range"]#annualInput, [data-rangeslider]', function(e) {
          valueOutput(e.target, currency = true);
        });

        // Initialize range slider and outputs
        $('input[type="range"]#annualInput').rangeslider({
          polyfill: false,
          onInit: function() {
            $annualOutput.value = $startingAnnual;
            valueOutput($annualOutput, currency = true);
            $hourlyOutput.value = $startingHourly;
            valueOutput($hourlyOutput, currency = true);
            $workDaysOutput.value = $startingWorkDays;
            valueOutput($workDaysOutput);
            $workHoursOutput.value = $startingWorkHours;
            valueOutput($workHoursOutput);
          },

          onSlide: function(position, value) {
              updateHourly();
          },

        });
      });
    </script>
  </body>
</html>
