<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="referrer" content="origin">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Convert annual salary into hourly rate</title>
    <!--[if lt IE 9]>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.js"></script>
    <![endif]-->
    <script src="assets/jquery.min.js"></script>
    <script src="assets/rangeslider.min.js"></script>
    <script src="assets/calculator.js"></script>
    <link rel="stylesheet" type="text/css" href="assets/calculator.css"/>
  </head>
  <body>
    <div class="container">
      <!-- Fade in from left to right, first annual, then equiv, than hourly (Right to left). Pulse once equiv every time slider ends, or assumption changes -->
      <h1>
        <table class="headline">
          <tr>
            <th>Annual Salary</th>
            <th rowspan="2"><div class="equivalency">=</div></th>
            <th>Hourly Rate</th>
          </tr>
          <tr>
            <th class="annual">
              <output id="annualOutput"></output>
            </th>
            <th class="hourly">
              <output id="hourlyOutput"></output>
            </th>
          </tr>
        </table>
      </h1>
      <input type="range" min="50000" max="250000" step="5000" value="150000" id="annualInput" data-rangeslider> </input>


      <h2>Assumptions</h2>
      <div class="column">
        <div class="variablesRow">
          <label for="workDaysOutput">Work Days per Year: </label>
          <button type="button" id="workDaysDecrement"><img class="decrement" src="assets/minus.png" /></button>
          <output id="workDaysOutput" type="number" value="261"></output>
          <button type="button" id="workDaysIncrement"><img class="increment" src="assets/increment.png" /></button>
        </div>
        <div class="variablesRow">
          <label for="hoursPerWorkDayOutput">Working Hours per Day: </label>
          <button type="button" id="hoursPerWorkDayDecrement"><img class="decrement" src="assets/minus.png" /></button>
          <output id="hoursPerWorkDayOutput" type="number" value="8"></output>
          <button type="button" id="hoursPerWorkDayIncrement"><img class="increment" src="assets/add.png" /></button>
        </div>
      </div>
    </div>
    <script>
      $(function() {
        $annualOutput = $('output#annualOutput')[0];
        $startingAnnual = 150000;
        $hourlyOutput = $('output#hourlyOutput')[0];
        $startingHourly = 100;
        // Assumptions for incrementing
        $workDaysOutput = $('output#workDaysOutput')[0];
        $startingWorkDays = 261;
        $hoursPerWorkDayOutput = $('output#hoursPerWorkDayOutput')[0];
        $startingHoursPerWorkDay = 8;

        // For ie8 support
        var textContent = ('textContent' in document) ? 'textContent' : 'innerText';

        // Helpers
        function valueOutput(element, currency = null) {
          var value = element.value;
          var output = element.parentNode.getElementsByTagName('output')[0] || element.parentNode.parentNode.getElementsByTagName('output')[0];
          var prepend = currency ? '$' : ''
          output[textContent] = prepend + Number(value).toLocaleString();
        }

        function adjustAndReturnTarget(element) {
          id = element.currentTarget.id;
          var minMaxLookup = {
            'workDaysIncrement': { 'max': 365 },
            'workDaysDecrement': { 'min': 0 },
            'hoursPerWorkDayIncrement': { 'max': 24 },
            'hoursPerWorkDayDecrement': { 'min': 0 },
          }

          var target = null;
          if (id.includes('Increment')) {
            target = element.target.parentElement.previousElementSibling;
            if (target.value < minMaxLookup[id]['max']) { target.value++; }
          } else if (id.includes('Decrement')) {
            target = element.target.parentElement.nextElementSibling;
            if (target.value > minMaxLookup[id]['min']) { target.value--; }
          } else {
            console.log('Uh oh. Something went wrong.');
          }

          return target;
        }

        // Increment/Decrement, then adjust the hourly total
        $("#workDaysIncrement, #workDaysDecrement, #hoursPerWorkDayIncrement, #hoursPerWorkDayDecrement").on('click', function (e) {
          var target = adjustAndReturnTarget(e);
          valueOutput(target);
          updateHourly();
        });

        function updateHourly() {
          // Recalculate new hourly total

          // Assign it to the element
          $hourlyOutput.value = 150;

          // Update the DOM
          valueOutput($hourlyOutput, currency = true);
        }

        $(document).on('input', 'input[type="range"]#annualInput, [data-rangeslider]', function(e) {
          valueOutput(e.target, currency = true);
        });

        // On any assumption's adjustment, recalculate hourly

        // Initialize range slider
        $('input[type="range"]#annualInput').rangeslider({
          polyfill: false,
          onInit: function() {
            $annualOutput.value = $startingAnnual;
            valueOutput($annualOutput, currency = true);
            $hourlyOutput.value = $startingHourly;
            valueOutput($hourlyOutput, currency = true);
            $workDaysOutput.value = $startingWorkDays;
            valueOutput($workDaysOutput);
            $hoursPerWorkDayOutput.value = $startingHoursPerWorkDay;
            valueOutput($hoursPerWorkDayOutput);
          },

          onSlide: function(position, value) {
              updateHourly();
          },

        });
      });
    </script>
  </body>
</html>
